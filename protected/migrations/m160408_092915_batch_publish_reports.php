<?php

use yii\db\Migration;

class m160408_092915_batch_publish_reports extends Migration
{
    protected $data = <<<TOKENS
2tcdkvsgnicatzh
3zhvuud5f88hkui
4ahdtn6q2qen4j9
54s6ggjfutusg5d
6gnz8bi65w4ne3v
6stx2d5q2m9ve7k
6xz8cjtyucan8dq
758ev9a88knykgm
7jebryiyv4ibdb2
8rrnk7janvucpmg
8suvzhp8qfjpg9d
9j9rf2rqkg2ygrd
a4mgicf8nm8uc3c
a85b5h5gbav6egb
ar9vi9trq5awncs
bfwkn2w6n5dzznz
bz5c785gbav4h5t
c69h9hh9x5khp8v
dkcra23cz8bbzwn
dnfcvtazdwcuqu7
e3zy5fnqw88bqnm
e5pmi9qjuv2mhwf
ejtfhtgwzu9saek
eu8mw34xi48u4gs
gfwzhcmfkeuzz5v
hqe36hz4rwjsuky
hrhxxn9gapi7pdz
jd5t438bzq9usyh
kp6g35wnj6zah8i
p588nuttgzr2p7b
pijaayxh72vd55c
qf324z4didmcei2
sjf79c4h98vimf6
upxr3866fn3tws4
uratyf5bzn9g3t7
utjasqfheejwyvd
v283xvfctetqu5u
wq7eb8d6ytqzik2
wr4eeb8igccudfv
yusw973r2uyatks
zg9adebb7dmpddc
zukynxpbu2jj8yv
031jg83hsnb9whx
2k7t2xx2pr7esxt
34h5h345h6ou86lrq
398gku6bv5tum87
3ntrbdebryixefz
4wfayduw7txrvsg
5uw69iv7d6s924d
642d3sd65zgheuh32
76859nfkskbh4g
7enppefanedw4rb
85fkj347hknxbna3
8bqnkn2ej88gx38
8niba42gt9fmseu
ads789mf3rslv0
btxkq4edjtzrjsy
dbzgjtevu5r7gdx
dk8k9tdbf9yhv9t
eftk22ddctkbafi
em346urmkdfqqb4
f9zuaxtnfecjkaf
fdskz463hdfka92
fvt2rvcacr9zmt5
fwdoiuhpiuhv239ksd
ge4igr4z7fjvcz2
gra7c3becevjsdq
guwjux66c7c3ip6
hb4j8bvjkd6mfuq
hfdsahjlljdL6644201
hhhvd744n899clj
hif8734hfe7zfhqp
k2zbs9998dpb7iz
ldfsnlvsfdasvoh6691
m6nf6p3pkwdt2qc
op9806ipozuzt
rqb325gfd7888ffqwd
sfzdgvshjkl55443jw
t4dechn5wd9paun
te0mb7jqvzwjfvsacdd
uioz5467zzg4gh471
ur8nks4mwn4nacd
wmman886a9ci5sb
x86re6htv5a3eai
xmje69pmf2vta92
yahr392j5dg35sc
znugk4erszxikjj
2tcdkvsgnicatzh
3zhvuud5f88hkui
4ahdtn6q2qen4j9
54s6ggjfutusg5d
6gnz8bi65w4ne3v
6stx2d5q2m9ve7k
6xz8cjtyucan8dq
758ev9a88knykgm
7jebryiyv4ibdb2
8rrnk7janvucpmg
8suvzhp8qfjpg9d
9j9rf2rqkg2ygrd
a4mgicf8nm8uc3c
a85b5h5gbav6egb
ar9vi9trq5awncs
bfwkn2w6n5dzznz
bz5c785gbav4h5t
c69h9hh9x5khp8v
dkcra23cz8bbzwn
dnfcvtazdwcuqu7
e3zy5fnqw88bqnm
e5pmi9qjuv2mhwf
ejtfhtgwzu9saek
eu8mw34xi48u4gs
gfwzhcmfkeuzz5v
hqe36hz4rwjsuky
hrhxxn9gapi7pdz
jd5t438bzq9usyh
kp6g35wnj6zah8i
p588nuttgzr2p7b
pijaayxh72vd55c
qf324z4didmcei2
sjf79c4h98vimf6
upxr3866fn3tws4
uratyf5bzn9g3t7
utjasqfheejwyvd
v283xvfctetqu5u
wq7eb8d6ytqzik2
wr4eeb8igccudfv
yusw973r2uyatks
zg9adebb7dmpddc
zukynxpbu2jj8yv
031jg83hsnb9whx
2k7t2xx2pr7esxt
34h5h345h6ou86lrq
398gku6bv5tum87
3ntrbdebryixefz
4wfayduw7txrvsg
5uw69iv7d6s924d
642d3sd65zgheuh32
76859nfkskbh4g
7enppefanedw4rb
85fkj347hknxbna3
8bqnkn2ej88gx38
8niba42gt9fmseu
ads789mf3rslv0
btxkq4edjtzrjsy
dbzgjtevu5r7gdx
dk8k9tdbf9yhv9t
eftk22ddctkbafi
em346urmkdfqqb4
f9zuaxtnfecjkaf
fdskz463hdfka92
fvt2rvcacr9zmt5
fwdoiuhpiuhv239ksd
ge4igr4z7fjvcz2
gra7c3becevjsdq
guwjux66c7c3ip6
hb4j8bvjkd6mfuq
hfdsahjlljdL6644201
hhhvd744n899clj
hif8734hfe7zfhqp
k2zbs9998dpb7iz
ldfsnlvsfdasvoh6691
m6nf6p3pkwdt2qc
op9806ipozuzt
rqb325gfd7888ffqwd
sfzdgvshjkl55443jw
t4dechn5wd9paun
te0mb7jqvzwjfvsacdd
uioz5467zzg4gh471
ur8nks4mwn4nacd
wmman886a9ci5sb
x86re6htv5a3eai
xmje69pmf2vta92
yahr392j5dg35sc
znugk4erszxikjj
2tcdkvsgnicatzh
3zhvuud5f88hkui
4ahdtn6q2qen4j9
54s6ggjfutusg5d
6gnz8bi65w4ne3v
6stx2d5q2m9ve7k
6xz8cjtyucan8dq
758ev9a88knykgm
7jebryiyv4ibdb2
8rrnk7janvucpmg
8suvzhp8qfjpg9d
9j9rf2rqkg2ygrd
a4mgicf8nm8uc3c
a85b5h5gbav6egb
ar9vi9trq5awncs
bfwkn2w6n5dzznz
bz5c785gbav4h5t
c69h9hh9x5khp8v
dkcra23cz8bbzwn
dnfcvtazdwcuqu7
e3zy5fnqw88bqnm
e5pmi9qjuv2mhwf
ejtfhtgwzu9saek
eu8mw34xi48u4gs
gfwzhcmfkeuzz5v
hqe36hz4rwjsuky
hrhxxn9gapi7pdz
jd5t438bzq9usyh
kp6g35wnj6zah8i
p588nuttgzr2p7b
pijaayxh72vd55c
qf324z4didmcei2
sjf79c4h98vimf6
upxr3866fn3tws4
uratyf5bzn9g3t7
utjasqfheejwyvd
v283xvfctetqu5u
wq7eb8d6ytqzik2
wr4eeb8igccudfv
yusw973r2uyatks
zg9adebb7dmpddc
zukynxpbu2jj8yv
031jg83hsnb9whx
2k7t2xx2pr7esxt
34h5h345h6ou86lrq
398gku6bv5tum87
3ntrbdebryixefz
4wfayduw7txrvsg
5uw69iv7d6s924d
642d3sd65zgheuh32
76859nfkskbh4g
7enppefanedw4rb
85fkj347hknxbna3
8bqnkn2ej88gx38
8niba42gt9fmseu
ads789mf3rslv0
btxkq4edjtzrjsy
dbzgjtevu5r7gdx
dk8k9tdbf9yhv9t
eftk22ddctkbafi
em346urmkdfqqb4
f9zuaxtnfecjkaf
fdskz463hdfka92
fvt2rvcacr9zmt5
fwdoiuhpiuhv239ksd
ge4igr4z7fjvcz2
gra7c3becevjsdq
guwjux66c7c3ip6
hb4j8bvjkd6mfuq
hfdsahjlljdL6644201
hhhvd744n899clj
hif8734hfe7zfhqp
k2zbs9998dpb7iz
ldfsnlvsfdasvoh6691
m6nf6p3pkwdt2qc
op9806ipozuzt
rqb325gfd7888ffqwd
sfzdgvshjkl55443jw
t4dechn5wd9paun
te0mb7jqvzwjfvsacdd
uioz5467zzg4gh471
ur8nks4mwn4nacd
wmman886a9ci5sb
x86re6htv5a3eai
xmje69pmf2vta92
yahr392j5dg35sc
znugk4erszxikjj
2tcdkvsgnicatzh
3zhvuud5f88hkui
4ahdtn6q2qen4j9
54s6ggjfutusg5d
6gnz8bi65w4ne3v
6stx2d5q2m9ve7k
6xz8cjtyucan8dq
758ev9a88knykgm
7jebryiyv4ibdb2
8rrnk7janvucpmg
8suvzhp8qfjpg9d
9j9rf2rqkg2ygrd
a4mgicf8nm8uc3c
a85b5h5gbav6egb
ar9vi9trq5awncs
bfwkn2w6n5dzznz
bz5c785gbav4h5t
c69h9hh9x5khp8v
dkcra23cz8bbzwn
dnfcvtazdwcuqu7
e3zy5fnqw88bqnm
e5pmi9qjuv2mhwf
ejtfhtgwzu9saek
eu8mw34xi48u4gs
gfwzhcmfkeuzz5v
hqe36hz4rwjsuky
hrhxxn9gapi7pdz
jd5t438bzq9usyh
kp6g35wnj6zah8i
p588nuttgzr2p7b
pijaayxh72vd55c
qf324z4didmcei2
sjf79c4h98vimf6
upxr3866fn3tws4
uratyf5bzn9g3t7
utjasqfheejwyvd
v283xvfctetqu5u
wq7eb8d6ytqzik2
wr4eeb8igccudfv
yusw973r2uyatks
zg9adebb7dmpddc
zukynxpbu2jj8yv
031jg83hsnb9whx
2k7t2xx2pr7esxt
34h5h345h6ou86lrq
398gku6bv5tum87
3ntrbdebryixefz
4wfayduw7txrvsg
5uw69iv7d6s924d
642d3sd65zgheuh32
76859nfkskbh4g
7enppefanedw4rb
85fkj347hknxbna3
8bqnkn2ej88gx38
8niba42gt9fmseu
ads789mf3rslv0
btxkq4edjtzrjsy
dbzgjtevu5r7gdx
dk8k9tdbf9yhv9t
eftk22ddctkbafi
em346urmkdfqqb4
f9zuaxtnfecjkaf
fdskz463hdfka92
fvt2rvcacr9zmt5
fwdoiuhpiuhv239ksd
ge4igr4z7fjvcz2
gra7c3becevjsdq
guwjux66c7c3ip6
hb4j8bvjkd6mfuq
hfdsahjlljdL6644201
hhhvd744n899clj
hif8734hfe7zfhqp
k2zbs9998dpb7iz
ldfsnlvsfdasvoh6691
m6nf6p3pkwdt2qc
op9806ipozuzt
rqb325gfd7888ffqwd
sfzdgvshjkl55443jw
t4dechn5wd9paun
te0mb7jqvzwjfvsacdd
uioz5467zzg4gh471
ur8nks4mwn4nacd
wmman886a9ci5sb
x86re6htv5a3eai
xmje69pmf2vta92
yahr392j5dg35sc
znugk4erszxikjj
TOKENS;


    // Use safeUp/safeDown to run migration code within a transaction
    public function safeUp()
    {
        /** @var \prime\models\ar\Project $project */
        foreach(\prime\models\ar\Project::findAll(['token' => explode("\n", $this->data)]) as $project) {
            $generator = \prime\factories\GeneratorFactory::get($project->default_generator);
            $published = new DateTimeImmutable($project->created);
            echo "Generating report...";
            $report = \prime\models\ar\Report::saveReport(
                $generator->render(
                    $project->getResponses(),
                    $project->getSurvey(),
                    $project,
                    $project->owner->createSignature($published),
                    new \prime\models\ar\UserData()
                ),
                $project->id,
                $project->default_generator
            );
            echo "OK\n";
        }
        return true;
    }

    public function safeDown()
    {
        return false;

    }

}
